# Cursor Rules - Desafio T√©cnico Full Stack Hubfy.ai

## üìã Contexto do Projeto

Este √© um sistema completo de gest√£o de tarefas desenvolvido como desafio t√©cnico para a Hubfy.ai. O projeto utiliza **Next.js 14+ full stack** com App Router, integrando frontend e backend em uma √∫nica aplica√ß√£o.

## üèóÔ∏è Arquitetura

### Estrutura do Projeto
- **Framework**: Next.js 14+ com App Router
- **Gerenciador de Pacotes**: pnpm (recomendado) ou npm
- **Banco de Dados**: MySQL 8+ via Prisma ORM
- **Autentica√ß√£o**: JWT (jsonwebtoken)
- **Valida√ß√£o**: Zod (backend e frontend)
- **Formul√°rios**: React Hook Form com valida√ß√£o Zod
- **Estado do Servidor**: TanStack Query (React Query)
- **Styling**: Tailwind CSS 3.4+

### Estrutura de Pastas
```
projeto/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api/                    # Next.js API Routes
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ login/route.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ register/route.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ tasks/
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ route.ts       # GET e POST
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ [id]/route.ts  # PUT e DELETE
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ login/page.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ register/page.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dashboard/page.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ globals.css
‚îÇ   ‚îú‚îÄ‚îÄ components/                 # Componentes React reutiliz√°veis
‚îÇ   ‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ db.ts                   # Prisma Client singleton
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.ts                 # Fun√ß√µes de autentica√ß√£o
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ middleware.ts           # Middleware de autentica√ß√£o
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api/                    # Fun√ß√µes de chamada √† API
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ tasks.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hooks/                  # Custom hooks
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ use-auth.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ use-tasks.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ providers/              # Providers React
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ query-provider.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ schemas/                 # Schemas Zod
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ auth.schema.ts
‚îÇ   ‚îî‚îÄ‚îÄ types/                       # Tipos TypeScript compartilhados
‚îÇ       ‚îî‚îÄ‚îÄ index.ts
‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îú‚îÄ‚îÄ api/                         # Testes de API Routes
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.test.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ tasks.test.ts
‚îÇ   ‚îî‚îÄ‚îÄ components/                  # Testes de componentes
‚îú‚îÄ‚îÄ prisma/
‚îÇ   ‚îî‚îÄ‚îÄ schema.prisma               # Schema do Prisma
‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îî‚îÄ‚îÄ schema.sql                   # Schema SQL (refer√™ncia)
‚îú‚îÄ‚îÄ .env.example
‚îú‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ API.md
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ tsconfig.json
‚îú‚îÄ‚îÄ next.config.js
‚îú‚îÄ‚îÄ tailwind.config.ts
‚îú‚îÄ‚îÄ jest.config.js
‚îî‚îÄ‚îÄ jest.setup.js
```

## üõ†Ô∏è Stack Tecnol√≥gica

### Frontend & Backend (Full Stack Next.js)
- **Next.js 14+** (App Router)
- **React 18+**
- **TypeScript 5.3+**
- **Prisma ORM** (MySQL)
- **Zod** (valida√ß√£o)
- **React Hook Form** (formul√°rios)
- **TanStack Query** (gerenciamento de estado e cache)
- **Tailwind CSS** (styling)
- **bcrypt** (hash de senhas)
- **jsonwebtoken** (autentica√ß√£o JWT)

### DevOps & Ferramentas
- **Jest** (testes)
- **ESLint** (linting)
- **Prettier** (formata√ß√£o)

## üîß Conven√ß√µes de C√≥digo

### TypeScript
- **Sempre usar TypeScript** - evitar `any`, usar tipos expl√≠citos
- **Interfaces/Types**: Definir em `src/types/index.ts`
- **Strict Mode**: Habilitado

### Nomenclatura
- **Arquivos**: kebab-case (ex: `auth.service.ts`, `task-card.tsx`)
- **Componentes React**: PascalCase (ex: `TaskCard.tsx`)
- **Classes/Interfaces**: PascalCase (ex: `AuthService`, `CreateTaskDto`)
- **Vari√°veis/Fun√ß√µes**: camelCase (ex: `getUserTasks`, `isAuthenticated`)
- **Constantes**: UPPER_SNAKE_CASE (ex: `JWT_SECRET`, `API_BASE_URL`)

### Next.js App Router
- **API Routes**: Criar em `src/app/api/` seguindo a estrutura de pastas
- **Server Components**: Preferir Server Components quando poss√≠vel
- **Client Components**: Sempre marcar com `'use client'` quando necess√°rio
- **Componentes**: Criar componentes reutiliz√°veis em `src/components/`
- **Hooks Customizados**: Criar em `src/lib/hooks/`
- **API Calls**: Criar fun√ß√µes em `src/lib/api/` para chamadas √† API
- **Valida√ß√£o**: Usar Zod para valida√ß√£o de dados (backend e frontend)
- **Formul√°rios**: Sempre usar React Hook Form com valida√ß√£o Zod
- **Estado do Servidor**: Usar TanStack Query para dados do servidor
- **Estado Local**: Usar useState/useReducer apenas para estado UI local

### Arquitetura em Camadas
- **API Routes** (`src/app/api/`): Controllers - apenas roteamento e valida√ß√£o
- **Lib Services** (`src/lib/`): L√≥gica de neg√≥cio (auth.ts, etc.)
- **Prisma** (`src/lib/db.ts`): Camada de dados (ORM)
- **Hooks** (`src/lib/hooks/`): Abstra√ß√£o de l√≥gica reutiliz√°vel
- **Types** (`src/types/`): Defini√ß√µes de tipos compartilhados

## üîí Seguran√ßa

### Obrigat√≥rio
- **Senhas**: Sempre hash com bcrypt (salt rounds: 10)
- **JWT**: Tokens com expira√ß√£o configur√°vel (padr√£o: 24h) e token_version
- **Valida√ß√£o**: Validar todos os inputs com Zod (backend e frontend)
- **SQL Injection**: Usar Prisma ORM - NUNCA SQL raw sem sanitiza√ß√£o
- **Vari√°veis Sens√≠veis**: Sempre usar `.env` - NUNCA commitar credenciais
- **Autentica√ß√£o**: Proteger todas as rotas de API que precisam autentica√ß√£o

### Isolamento de Dados
- Usu√°rios s√≥ podem acessar suas pr√≥prias tarefas
- Validar `user_id` em todas as opera√ß√µes de tarefas
- Usar middleware de autentica√ß√£o em todas as rotas protegidas

## üìù Padr√µes de Desenvolvimento

### Commits
- **OBRIGAT√ìRIO**: Fazer um commit separado para cada arquivo alterado/criado
- Cada altera√ß√£o deve ter seu pr√≥prio commit com mensagem descritiva
- Usar Conventional Commits
- Exemplos:
  - `feat: adiciona p√°gina de login`
  - `fix: corrige valida√ß√£o de email`
  - `refactor: reorganiza estrutura de componentes`
  - `test: adiciona testes para auth routes`
  - `docs: atualiza documenta√ß√£o da API`
- **Regra de Commits Separados**:
  - Se voc√™ modificar m√∫ltiplos arquivos, criar um commit para cada arquivo
  - Se criar novos arquivos, cada arquivo novo deve ter seu pr√≥prio commit
  - Commits devem ser at√¥micos e focados em uma √∫nica mudan√ßa
  - Exemplo: Se voc√™ adicionar valida√ß√£o em 5 arquivos, fazer 5 commits separados

### Testes

#### Configura√ß√£o
- **Ferramentas**: Jest + React Testing Library
- **Ambiente**: Node.js (para testes de API Routes)
- **Configura√ß√£o**: `jest.config.js` e `jest.setup.js`
- **Localiza√ß√£o**: `tests/api/` para testes de API, `tests/components/` para componentes

#### Requisitos de Testes de Backend (Obrigat√≥rio)
- **Testes de integra√ß√£o** para todos os endpoints da API
- **Cobertura m√≠nima**: 60% dos endpoints
- **Testar autentica√ß√£o**: registro, login, token inv√°lido
- **Testar CRUD de tarefas**: GET, POST, PUT, DELETE
- **Testar isolamento de dados**: usu√°rios s√≥ podem acessar suas pr√≥prias tarefas
- **Usar mocks** para Prisma, bcrypt e middleware de autentica√ß√£o

#### Estrutura de Testes
```typescript
// tests/api/auth.test.ts
import { POST } from '@/app/api/auth/register/route';
import { NextRequest } from 'next/server';
import { prisma } from '@/lib/db';

jest.mock('@/lib/db', () => ({
  prisma: {
    user: {
      findUnique: jest.fn(),
      create: jest.fn(),
    },
  },
}));

describe('Auth API Routes', () => {
  beforeEach(() => {
    jest.clearAllMocks();
  });

  describe('POST /api/auth/register', () => {
    it('deve registrar um novo usu√°rio com sucesso', async () => {
      // Arrange
      const mockUser = { id: 1, name: 'Jo√£o', email: 'joao@example.com' };
      (prisma.user.findUnique as jest.Mock).mockResolvedValue(null);
      (prisma.user.create as jest.Mock).mockResolvedValue(mockUser);

      // Act
      const request = new NextRequest('http://localhost:3000/api/auth/register', {
        method: 'POST',
        body: JSON.stringify({ name: 'Jo√£o', email: 'joao@example.com', password: 'Senha123!@#' }),
      });
      const response = await POST(request);
      const data = await response.json();

      // Assert
      expect(response.status).toBe(201);
      expect(data.message).toBe('Usu√°rio criado com sucesso');
    });
  });
});
```

#### Padr√µes de Testes
- **Arrange-Act-Assert (AAA)**: Organizar, Executar, Verificar
- **Mocks**: Sempre mockar depend√™ncias externas (Prisma, bcrypt, etc.)
- **Isolamento**: Cada teste deve ser independente
- **Nomes descritivos**: Usar nomes que descrevam o comportamento esperado
- **Cen√°rios de erro**: Testar casos de sucesso e erro

#### Executando Testes
```bash
# Executar todos os testes
pnpm test

# Executar testes em modo watch (desenvolvimento)
pnpm test:watch

# Executar testes com cobertura
pnpm test:cov

# Executar testes de um arquivo espec√≠fico
pnpm test tests/api/auth.test.ts
```

#### Checklist de Testes
Antes de commitar c√≥digo novo:
- [ ] Testes escritos para novos endpoints
- [ ] Testes de autentica√ß√£o (sucesso e erro)
- [ ] Testes de isolamento de dados
- [ ] Testes de valida√ß√£o de entrada
- [ ] Testes de tratamento de erros
- [ ] Todos os testes passando
- [ ] Cobertura m√≠nima de 60% atingida

### Formata√ß√£o
- **Prettier**: Configurado no projeto
- **ESLint**: Configurado para Next.js
- **Formata√ß√£o autom√°tica**: Executar `pnpm format` antes de commitar
- **Configura√ß√£o**: `.prettierrc` e `.prettierignore` na raiz

## üóÑÔ∏è Banco de Dados

### Schema
- **ORM**: Prisma (`prisma/schema.prisma`)
- **Tabelas**:
  - `users`: id, name, email, password, token_version, created_at
  - `tasks`: id, user_id, title, description, status, created_at, updated_at
- **√çndices**: Criados para otimiza√ß√£o (email, user_id, status)
- **Foreign Keys**: user_id referencia users(id) ON DELETE CASCADE

### Conex√£o
- **Prisma Client**: `src/lib/db.ts` (singleton pattern)
- **Configura√ß√£o**: Via vari√°veis de ambiente (DATABASE_URL)

## üåê API Endpoints

### Autentica√ß√£o
- `POST /api/auth/register` - Registro de usu√°rios
- `POST /api/auth/login` - Login e obten√ß√£o de JWT

### Tarefas (Protegidas)
- `GET /api/tasks` - Listar tarefas do usu√°rio
- `POST /api/tasks` - Criar nova tarefa
- `PUT /api/tasks/:id` - Atualizar tarefa
- `DELETE /api/tasks/:id` - Deletar tarefa

### Documenta√ß√£o
- Ver `API.md` para documenta√ß√£o completa dos endpoints

## üîÑ Fluxo de Desenvolvimento

### 1. Configura√ß√£o Inicial
```bash
# Instalar depend√™ncias
pnpm install

# Gerar Prisma Client
pnpm prisma generate

# Configurar banco de dados
docker-compose up -d
# ou
mysql -u root -p < database/schema.sql

# Executar migra√ß√µes Prisma (se necess√°rio)
pnpm prisma migrate dev

# Configurar vari√°veis de ambiente
cp .env.example .env
# Editar .env com credenciais
```

### 2. Desenvolvimento
```bash
# Executar servidor de desenvolvimento
pnpm dev

# Build de produ√ß√£o
pnpm build

# Executar produ√ß√£o
pnpm start
```

### 3. Testes
```bash
# Todos os testes
pnpm test

# Testes em modo watch
pnpm test:watch

# Cobertura de testes
pnpm test:cov
```

### 4. Prisma
```bash
# Gerar Prisma Client
pnpm prisma generate

# Criar migra√ß√£o
pnpm prisma migrate dev

# Abrir Prisma Studio
pnpm prisma studio

# Push schema (desenvolvimento)
pnpm db:push
```

## üì¶ Vari√°veis de Ambiente

### .env
```env
# Next.js
NODE_ENV=development
PORT=3000

# Database (Prisma)
DATABASE_URL="mysql://root:root@localhost:3306/task_manager"

# JWT
JWT_SECRET=your_super_secret_jwt_key_change_in_production
JWT_EXPIRES_IN=24h
```

## üéØ Decis√µes T√©cnicas Importantes

### Por que Next.js Full Stack?
- Arquitetura unificada simplifica desenvolvimento
- API Routes integradas com App Router
- Server Components para melhor performance
- Deploy simplificado (uma √∫nica aplica√ß√£o)
- Compartilhamento de tipos entre frontend e backend

### Por que Prisma?
- Type-safe queries
- Migrations autom√°ticas
- Gera√ß√£o autom√°tica de tipos TypeScript
- Melhor DX (Developer Experience)
- Suporte a m√∫ltiplos bancos de dados

### Por que React Hook Form?
- Performance otimizada (menos re-renders)
- Valida√ß√£o integrada com Zod
- Melhor UX (valida√ß√£o em tempo real)
- Menos c√≥digo boilerplate

### Por que TanStack Query?
- Cache autom√°tico de requisi√ß√µes
- Sincroniza√ß√£o de estado do servidor
- Refetch autom√°tico
- Otimistic updates
- Melhor gerenciamento de loading/error states

## üö´ O Que N√ÉO Fazer

- ‚ùå Commitar arquivos `.env` com credenciais reais
- ‚ùå Armazenar senhas em texto plano
- ‚ùå Usar SQL raw sem sanitiza√ß√£o (usar Prisma)
- ‚ùå Deixar endpoints sem autentica√ß√£o quando necess√°rio
- ‚ùå Usar `any` no TypeScript sem necessidade
- ‚ùå Ignorar tratamento de erros
- ‚ùå Criar componentes muito grandes (dividir em menores)
- ‚ùå Hardcode de valores (usar vari√°veis de ambiente)
- ‚ùå Misturar l√≥gica de neg√≥cio nas API Routes (usar lib/)
- ‚ùå Criar formul√°rios sem React Hook Form
- ‚ùå Fazer chamadas diretas √† API sem TanStack Query

## ‚úÖ Checklist de Qualidade

Antes de commitar, verificar:
- [ ] C√≥digo formatado com Prettier
- [ ] Sem erros de lint
- [ ] TypeScript sem erros
- [ ] Testes passando
- [ ] Vari√°veis de ambiente n√£o commitadas
- [ ] Commits com mensagens descritivas
- [ ] C√≥digo segue as conven√ß√µes do projeto
- [ ] Formul√°rios usam React Hook Form
- [ ] Chamadas √† API usam TanStack Query
- [ ] Valida√ß√£o com Zod implementada

## üìö Recursos √öteis

- [Next.js Docs](https://nextjs.org/docs)
- [Prisma Docs](https://www.prisma.io/docs)
- [React Hook Form Docs](https://react-hook-form.com/)
- [TanStack Query Docs](https://tanstack.com/query/latest)
- [Zod Docs](https://zod.dev/)
- [Tailwind CSS Docs](https://tailwindcss.com/docs)
- [JWT.io](https://jwt.io/)

## üé® Padr√µes de UI/UX

### Frontend
- **Responsividade**: Mobile-first com Tailwind CSS
- **Loading States**: Sempre mostrar indicadores de loading
- **Error Handling**: Mensagens de erro claras e amig√°veis
- **Valida√ß√£o**: Valida√ß√£o em tempo real nos formul√°rios (React Hook Form + Zod)
- **Feedback Visual**: Feedback imediato para a√ß√µes do usu√°rio
- **TanStack Query**: Usar estados isLoading, isError, isSuccess para UI

### Cores e Estilo
- Usar classes Tailwind CSS
- Manter consist√™ncia visual
- Seguir design system quando aplic√°vel

## üîÑ Padr√µes de C√≥digo

### API Routes
```typescript
// src/app/api/example/route.ts
import { NextRequest, NextResponse } from 'next/server';
import { z } from 'zod';
import { authenticateRequest } from '@/lib/middleware';

const schema = z.object({
  // schema definition
});

export async function GET(request: NextRequest) {
  const authResult = await authenticateRequest(request);
  if (authResult instanceof NextResponse) return authResult;
  
  // l√≥gica
  return NextResponse.json({ data });
}
```

### React Hook Form
```typescript
// src/app/example/page.tsx
'use client';

import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { schema, FormData } from '@/lib/schemas/example.schema';

export default function ExamplePage() {
  const { register, handleSubmit, formState: { errors } } = useForm<FormData>({
    resolver: zodResolver(schema),
  });

  const onSubmit = (data: FormData) => {
    // handle submit
  };

  return <form onSubmit={handleSubmit(onSubmit)}>...</form>;
}
```

### TanStack Query
```typescript
// src/lib/hooks/use-example.ts
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { getData, createData } from '@/lib/api/example';

export function useData() {
  return useQuery({
    queryKey: ['data'],
    queryFn: getData,
  });
}

export function useCreateData() {
  const queryClient = useQueryClient();
  return useMutation({
    mutationFn: createData,
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['data'] });
    },
  });
}
```

---

**√öltima atualiza√ß√£o**: Projeto refatorado para Next.js full stack com React Hook Form e TanStack Query.
