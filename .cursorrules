# Cursor Rules - Desafio TÃ©cnico Full Stack Hubfy.ai

## ğŸ“‹ Contexto do Projeto

Este Ã© um sistema completo de gestÃ£o de tarefas desenvolvido como desafio tÃ©cnico para a Hubfy.ai. O projeto utiliza uma arquitetura de **monorepo** com **Turborepo**, separando frontend (Next.js) e backend (NestJS) em workspaces independentes.

## ğŸ—ï¸ Arquitetura

### Estrutura do Monorepo
- **Gerenciador de Pacotes**: pnpm 8.15.0+ (obrigatÃ³rio)
- **OrquestraÃ§Ã£o**: Turborepo 2.0+
- **Workspaces**: Configurados automaticamente pelo pnpm
  - `apps/web` - Frontend Next.js
  - `apps/api` - Backend NestJS
  - `packages/` - Pacotes compartilhados (futuro)
- **Scripts do Turborepo**:
  - `dev`: Modo desenvolvimento (cache desabilitado, persistente)
  - `build`: Build com dependÃªncias entre workspaces
  - `test`: Testes com dependÃªncia de build
  - `lint`: Linting com dependÃªncias entre workspaces
  - `clean`: Limpeza sem cache

### Frontend (apps/web)
- **Framework**: Next.js 14+ com App Router
- **React**: 18+
- **TypeScript**: 5.3+
- **Styling**: Tailwind CSS 3.4+
- **Estrutura**:
  - `src/app/` - PÃ¡ginas e rotas (App Router)
  - `src/components/` - Componentes React reutilizÃ¡veis
  - `src/lib/` - UtilitÃ¡rios e helpers
  - `src/types/` - DefiniÃ§Ãµes TypeScript

### Backend (apps/api)
- **Framework**: NestJS 10+
- **TypeScript**: 5.3+
- **Banco de Dados**: MySQL 8+ (mysql2)
- **AutenticaÃ§Ã£o**: JWT (@nestjs/jwt)
- **ValidaÃ§Ã£o**: class-validator
- **Hash de Senhas**: bcrypt
- **Estrutura Modular**:
  - `src/auth/` - MÃ³dulo de autenticaÃ§Ã£o
  - `src/tasks/` - MÃ³dulo de tarefas
  - `src/database/` - ConfiguraÃ§Ã£o do banco
  - `src/common/` - Guards, decorators, interceptors

## ğŸ› ï¸ Stack TecnolÃ³gica

### Frontend
- Next.js 14+ (App Router)
- React 18+
- TypeScript
- Tailwind CSS
- React Hook Form (diferencial - usar quando apropriado)
- TanStack Query (diferencial - para gerenciamento de estado e cache)

### Backend
- NestJS 10+
- TypeScript
- MySQL 8+ (mysql2 - prepared statements)
- JWT (@nestjs/jwt)
- bcrypt (hash de senhas)
- class-validator (validaÃ§Ã£o de DTOs)
- Prisma ou Drizzle (diferencial - considerar ORM)

### DevOps & Ferramentas
- Turborepo (monorepo)
- Jest (testes)
- ESLint (linting)
- Prettier (formataÃ§Ã£o)

## ğŸ“ Estrutura de Pastas

```
desafio/
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ web/              # Frontend Next.js
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ app/      # PÃ¡ginas (App Router)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ register/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ dashboard/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ layout.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ components/  # Componentes React
â”‚   â”‚   â”‚   â”œâ”€â”€ lib/        # UtilitÃ¡rios
â”‚   â”‚   â”‚   â””â”€â”€ types/      # Tipos TypeScript
â”‚   â”‚   â”œâ”€â”€ package.json
â”‚   â”‚   â”œâ”€â”€ next.config.js
â”‚   â”‚   â”œâ”€â”€ tailwind.config.ts
â”‚   â”‚   â””â”€â”€ tsconfig.json
â”‚   â”‚
â”‚   â””â”€â”€ api/              # Backend NestJS
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â”œâ”€â”€ auth/     # MÃ³dulo de autenticaÃ§Ã£o
â”‚       â”‚   â”‚   â”œâ”€â”€ auth.module.ts
â”‚       â”‚   â”‚   â”œâ”€â”€ auth.controller.ts
â”‚       â”‚   â”‚   â”œâ”€â”€ auth.service.ts
â”‚       â”‚   â”‚   â”œâ”€â”€ dto/
â”‚       â”‚   â”‚   â””â”€â”€ strategies/
â”‚       â”‚   â”œâ”€â”€ tasks/    # MÃ³dulo de tarefas
â”‚       â”‚   â”‚   â”œâ”€â”€ tasks.module.ts
â”‚       â”‚   â”‚   â”œâ”€â”€ tasks.controller.ts
â”‚       â”‚   â”‚   â”œâ”€â”€ tasks.service.ts
â”‚       â”‚   â”‚   â””â”€â”€ dto/
â”‚       â”‚   â”œâ”€â”€ database/ # ConfiguraÃ§Ã£o do banco
â”‚       â”‚   â”‚   â””â”€â”€ database.module.ts
â”‚       â”‚   â”œâ”€â”€ common/   # Recursos compartilhados
â”‚       â”‚   â”‚   â”œâ”€â”€ guards/
â”‚       â”‚   â”‚   â”œâ”€â”€ decorators/
â”‚       â”‚   â”‚   â””â”€â”€ interceptors/
â”‚       â”‚   â”œâ”€â”€ app.module.ts
â”‚       â”‚   â””â”€â”€ main.ts
â”‚       â”œâ”€â”€ package.json
â”‚       â”œâ”€â”€ nest-cli.json
â”‚       â””â”€â”€ tsconfig.json
â”‚
â”œâ”€â”€ database/
â”‚   â””â”€â”€ schema.sql        # Schema do banco de dados MySQL
â”‚
â”œâ”€â”€ packages/             # Pacotes compartilhados (futuro)
â”‚
â”œâ”€â”€ package.json         # ConfiguraÃ§Ã£o raiz do monorepo
â”œâ”€â”€ turbo.json           # ConfiguraÃ§Ã£o do Turborepo
â”œâ”€â”€ docker-compose.yaml  # MySQL container
â”œâ”€â”€ env.example          # Exemplo de variÃ¡veis de ambiente
â”œâ”€â”€ README.md
â””â”€â”€ API.md
```

## ğŸ”§ ConvenÃ§Ãµes de CÃ³digo

### TypeScript
- **Sempre usar TypeScript** - evitar `any`, usar tipos explÃ­citos
- **Interfaces/Types**: Definir em `src/types/` (frontend) ou junto aos mÃ³dulos (backend)
- **Strict Mode**: Habilitado em ambos os projetos

### Nomenclatura
- **Arquivos**: kebab-case (ex: `auth.service.ts`, `task-card.tsx`)
- **Componentes React**: PascalCase (ex: `TaskCard.tsx`)
- **Classes/Interfaces**: PascalCase (ex: `AuthService`, `CreateTaskDto`)
- **VariÃ¡veis/FunÃ§Ãµes**: camelCase (ex: `getUserTasks`, `isAuthenticated`)
- **Constantes**: UPPER_SNAKE_CASE (ex: `JWT_SECRET`, `API_BASE_URL`)

### Frontend (Next.js)
- **App Router**: Usar App Router do Next.js 14+
- **Server Components**: Preferir Server Components quando possÃ­vel
- **Client Components**: Marcar com `'use client'` quando necessÃ¡rio
- **Componentes**: Criar componentes reutilizÃ¡veis em `src/components/`
- **Hooks**: Custom hooks em `src/lib/hooks/`
- **API Calls**: Criar funÃ§Ãµes em `src/lib/api/` para chamadas Ã  API
- **ValidaÃ§Ã£o**: Usar React Hook Form para formulÃ¡rios
- **Estado**: TanStack Query para estado do servidor, useState/useReducer para estado local

### Backend (NestJS)
- **MÃ³dulos**: Um mÃ³dulo por feature (auth, tasks, etc.)
- **DTOs**: Sempre usar DTOs com class-validator para validaÃ§Ã£o
- **Services**: LÃ³gica de negÃ³cio nos services
- **Controllers**: Apenas roteamento e validaÃ§Ã£o bÃ¡sica
- **Guards**: Usar guards para autenticaÃ§Ã£o/autorizaÃ§Ã£o
- **Database**: Usar prepared statements (mysql2) para prevenir SQL injection
- **Erros**: Usar exceÃ§Ãµes do NestJS (NotFoundException, UnauthorizedException, etc.)

## ğŸ”’ SeguranÃ§a

### ObrigatÃ³rio
- **Senhas**: Sempre hash com bcrypt (salt rounds: 10)
- **JWT**: Tokens com expiraÃ§Ã£o configurÃ¡vel (padrÃ£o: 24h)
- **ValidaÃ§Ã£o**: Validar todos os inputs com class-validator (backend) e React Hook Form (frontend)
- **SQL Injection**: Usar prepared statements (mysql2) - NUNCA concatenar strings SQL
- **CORS**: Configurado para permitir apenas o frontend autorizado
- **VariÃ¡veis SensÃ­veis**: Sempre usar `.env` - NUNCA commitar credenciais

### Isolamento de Dados
- UsuÃ¡rios sÃ³ podem acessar suas prÃ³prias tarefas
- Validar `user_id` em todas as operaÃ§Ãµes de tarefas
- Usar guards JWT em todas as rotas protegidas

## ğŸ“ PadrÃµes de Desenvolvimento

### Commits
- **OBRIGATÃ“RIO**: Fazer um commit separado para cada arquivo alterado/criado
- Cada alteraÃ§Ã£o deve ter seu prÃ³prio commit com mensagem descritiva
- Usar Conventional Commits
- Exemplos:
  - `feat: adiciona pÃ¡gina de login`
  - `fix: corrige validaÃ§Ã£o de email`
  - `refactor: reorganiza estrutura de componentes`
  - `test: adiciona testes para auth service`
  - `docs: adiciona decorators Swagger no AuthController`
- **Regra de Commits Separados**:
  - Se vocÃª modificar mÃºltiplos arquivos, criar um commit para cada arquivo
  - Se criar novos arquivos, cada arquivo novo deve ter seu prÃ³prio commit
  - Commits devem ser atÃ´micos e focados em uma Ãºnica mudanÃ§a
  - Exemplo: Se vocÃª adicionar Swagger em 5 arquivos, fazer 5 commits separados

### Testes
- **Backend**: Testes obrigatÃ³rios para endpoints da API
- **Cobertura mÃ­nima**: 60% dos endpoints
- **LocalizaÃ§Ã£o**: `apps/api/test/` ou `apps/api/src/**/*.spec.ts`
- **Ferramentas**: Jest + Supertest
- **Frontend**: Testes de componentes com React Testing Library (diferencial)

### FormataÃ§Ã£o
- **Prettier**: Configurado no projeto raiz
- **ESLint**: Configurado em cada workspace
- **FormataÃ§Ã£o automÃ¡tica**: Executar `pnpm format` antes de commitar
- **ConfiguraÃ§Ã£o**: `.prettierrc` e `.prettierignore` na raiz

## ğŸ—„ï¸ Banco de Dados

### Schema
- **Arquivo**: `database/schema.sql`
- **Tabelas**:
  - `users`: id, name, email, password, created_at
  - `tasks`: id, user_id, title, description, status, created_at, updated_at
- **Ãndices**: Criados para otimizaÃ§Ã£o (email, user_id, status)
- **Foreign Keys**: user_id referencia users(id) ON DELETE CASCADE

### ConexÃ£o
- **MÃ³dulo**: `apps/api/src/database/database.module.ts`
- **Provider**: `DATABASE_CONNECTION` injetado via dependency injection
- **ConfiguraÃ§Ã£o**: Via variÃ¡veis de ambiente (DB_HOST, DB_PORT, etc.)

## ğŸŒ API Endpoints

### AutenticaÃ§Ã£o
- `POST /auth/register` - Registro de usuÃ¡rios
- `POST /auth/login` - Login e obtenÃ§Ã£o de JWT

### Tarefas (Protegidas)
- `GET /tasks` - Listar tarefas do usuÃ¡rio
- `POST /tasks` - Criar nova tarefa
- `PUT /tasks/:id` - Atualizar tarefa
- `DELETE /tasks/:id` - Deletar tarefa

### DocumentaÃ§Ã£o
- Ver `API.md` para documentaÃ§Ã£o completa dos endpoints

## ğŸ”„ Fluxo de Desenvolvimento

### 1. ConfiguraÃ§Ã£o Inicial
```bash
# IMPORTANTE: Usar pnpm (nÃ£o npm ou yarn)
# Instalar dependÃªncias
pnpm install

# Configurar banco de dados
docker-compose up -d
# ou
mysql -u root -p < database/schema.sql

# Configurar variÃ¡veis de ambiente
cp env.example .env
# Editar .env com credenciais
```

### 2. Desenvolvimento
```bash
# Executar tudo (via Turborepo)
pnpm dev

# Executar apenas frontend
cd apps/web && pnpm dev

# Executar apenas backend
cd apps/api && pnpm dev

# Build de tudo
pnpm build
```

### 3. Testes
```bash
# Todos os testes
pnpm test

# Backend apenas
cd apps/api && pnpm test

# Frontend apenas
cd apps/web && pnpm test
```

## ğŸ“¦ VariÃ¡veis de Ambiente

### Raiz (.env)
```env
PORT=3001
NODE_ENV=development
NEXT_PUBLIC_API_URL=http://localhost:3001
FRONTEND_URL=http://localhost:3000
DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASSWORD=your_password
DB_NAME=task_manager
JWT_SECRET=your_super_secret_jwt_key
JWT_EXPIRES_IN=24h
```

## ğŸ¯ DecisÃµes TÃ©cnicas Importantes

### Por que Monorepo?
- Compartilhamento de cÃ³digo entre frontend e backend
- Builds otimizados com cache do Turborepo
- Gerenciamento simplificado de dependÃªncias
- Facilita CI/CD

### Por que NestJS ao invÃ©s de Next.js API Routes?
- Arquitetura modular e escalÃ¡vel
- Melhor separaÃ§Ã£o de responsabilidades
- Suporte nativo a TypeScript
- Ecossistema robusto para APIs REST
- Facilita testes e manutenÃ§Ã£o

### Por que Next.js App Router?
- Melhor performance e SEO
- Server Components por padrÃ£o
- Roteamento baseado em arquivos simplificado
- Suporte nativo a layouts e loading states

### Por que pnpm?
- Mais rÃ¡pido que npm/yarn
- Melhor gerenciamento de espaÃ§o em disco
- Suporte nativo a workspaces
- CompatÃ­vel com Turborepo

## ğŸš« O Que NÃƒO Fazer

- âŒ Commitar arquivos `.env` com credenciais reais
- âŒ Armazenar senhas em texto plano
- âŒ Concatenar strings SQL (usar prepared statements)
- âŒ Deixar endpoints sem autenticaÃ§Ã£o quando necessÃ¡rio
- âŒ Usar `any` no TypeScript sem necessidade
- âŒ Ignorar tratamento de erros
- âŒ Criar componentes muito grandes (dividir em menores)
- âŒ Hardcode de valores (usar variÃ¡veis de ambiente)

## âœ… Checklist de Qualidade

Antes de commitar, verificar:
- [ ] CÃ³digo formatado com Prettier
- [ ] Sem erros de lint
- [ ] TypeScript sem erros
- [ ] Testes passando
- [ ] VariÃ¡veis de ambiente nÃ£o commitadas
- [ ] Commits com mensagens descritivas
- [ ] CÃ³digo segue as convenÃ§Ãµes do projeto

## ğŸ“š Recursos Ãšteis

- [Next.js Docs](https://nextjs.org/docs)
- [NestJS Docs](https://docs.nestjs.com)
- [Turborepo Docs](https://turbo.build/repo/docs)
- [Tailwind CSS Docs](https://tailwindcss.com/docs)
- [JWT.io](https://jwt.io/)
- [MySQL Docs](https://dev.mysql.com/doc/)

## ğŸ¨ PadrÃµes de UI/UX

### Frontend
- **Responsividade**: Mobile-first com Tailwind CSS
- **Loading States**: Sempre mostrar indicadores de loading
- **Error Handling**: Mensagens de erro claras e amigÃ¡veis
- **ValidaÃ§Ã£o**: ValidaÃ§Ã£o em tempo real nos formulÃ¡rios
- **Feedback Visual**: Feedback imediato para aÃ§Ãµes do usuÃ¡rio

### Cores e Estilo
- Usar classes Tailwind CSS
- Manter consistÃªncia visual
- Seguir design system quando aplicÃ¡vel

---

**Ãšltima atualizaÃ§Ã£o**: Estrutura inicial do monorepo com Turborepo, Next.js e NestJS configurados.

